!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t,e,s){var i=function(t,e,s){Array.isArray(t)&&(s=e=t,t=void 0),t&&t.onEditClose&&(this.handlers={onEditClose:t.onEditClose},t.onEditClose=!0),this._whitelistOverride=e,this._sslOverride=s,this._messageId=1,this._messages={0:function(){}},this._readyToPost=!1,this._pendingMessages=[],this._receiveMessage=this._receiveMessage.bind(this),window.addEventListener("message",this._receiveMessage,!1),window.parent.postMessage({method:"handShake",origin:window.location.origin,payload:t},"*")};i.prototype.execute=function(t,e){var s=(e=e||{}).data,i=e.success;this._readyToPost?this._post({method:t,payload:s},i):this._pendingMessages.push({method:t,payload:s,callback:i})},i.prototype.getCentralData=function(t){this.execute("getCentralData",{success:t})},i.prototype.getContent=function(t){this.execute("getContent",{success:t})},i.prototype.getData=function(t){this.execute("getData",{success:t})},i.prototype.getUserData=function(t){this.execute("getUserData",{success:t})},i.prototype.getView=function(t){this.execute("getView",{success:t})},i.prototype.setBlockEditorWidth=function(t,e){this.execute("setBlockEditorWidth",{data:t,success:e})},i.prototype.setCentralData=function(t,e){this.execute("setCentralData",{data:t,success:e})},i.prototype.setContent=function(t,e){this.execute("setContent",{data:t,success:e})},i.prototype.setData=function(t,e){this.execute("setData",{data:t,success:e})},i.prototype.setSuperContent=function(t,e){this.execute("setSuperContent",{data:t,success:e})},i.prototype.triggerAuth=function(t){this.getUserData((function(e){var s=e.stack;0===s.indexOf("qa")&&(s=s.substring(3,5)+"."+s.substring(0,3));var i=document.createElement("IFRAME");i.src="https://mc."+s+".exacttarget.com/cloud/tools/SSO.aspx?appId="+t+"&restToken=1&hub=1",i.style.width="1px",i.style.height="1px",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.visibility="hidden",i.className="authframe",document.body.appendChild(i)}))},i.prototype.triggerAuth2=function(t){var e=document.createElement("IFRAME"),s="",i="";Array.isArray(t.scope)&&(s="&scope="+t.scope.join("%20")),t.state&&(i="&state="+t.state),e.src=t.authURL+(t.authURL.endsWith("/")?"":"/")+"v2/authorize?response_type=code&client_id="+t.clientId+"&redirect_uri="+encodeURIComponent(t.redirectURL)+s+i,e.style.width="1px",e.style.height="1px",e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.visibility="hidden",e.className="authframe",document.body.appendChild(e)},i.prototype._executePendingMessages=function(){var t=this;this._pendingMessages.forEach((function(e){t.execute(e.method,{data:e.payload,success:e.callback})})),this._pendingMessages=[]},i.prototype._post=function(t,e){this._messages[this._messageId]=e,t.id=this._messageId,this._messageId+=1,window.parent.postMessage(t,this._parentOrigin)},i.prototype._receiveMessage=function(t){var e=(t=t||{}).data||{};if("handShake"===e.method){if(this._validateOrigin(e.origin))return this._parentOrigin=e.origin,this._readyToPost=!0,void this._executePendingMessages()}else if("closeBlock"===e.method&&this._validateOrigin(e.origin))return this.handlers&&this.handlers.onEditClose&&this.handlers.onEditClose(),void this.execute("blockReadyToClose");this._parentOrigin&&this._parentOrigin===t.origin&&((this._messages[e.id||0]||function(){})(e.payload),delete this._messages[e.id])},i.prototype._validateOrigin=function(t){for(var e=this._whitelistOverride||["exacttarget\\.com","marketingcloudapps\\.com","blocktester\\.herokuapp\\.com"],s=0;s<e.length;s++){var i=this._sslOverride?"?":"",n="exacttarget\\.com"===e[s]?"mc\\.":"";if(new RegExp("^https"+i+"://"+n+"([a-zA-Z0-9-]+\\.)*"+e[s]+"(:[0-9]+)?$","i").test(t))return!0}return!1},"object"==typeof window&&(window.sfdc=window.sfdc||{},window.sfdc.BlockSDK=i),t.exports=i},function(t,e){let s=document.createElement("template");s.innerHTML='\n<article class="slds-box slds-box" style="cursor: pointer; height: 100%;">\n\t<span class="name" style="word-break: break-all;"></span>\n\t<span class="dimensions" style="display: block; text-align: center; font-weight: bold;"></span>\n\t<div class="slds-card__body slds-card__body_inner">\n\t\t<img />\n\t</div>\n</article>\n';class i extends HTMLElement{connectedCallback(){this.appendChild(s.content.cloneNode(!0)),this.getElementsByClassName("name")[0].innerText=this.getAttribute("name"),this.getElementsByClassName("dimensions")[0].innerText=`${this.getAttribute("imgHeight")} x ${this.getAttribute("imgWidth")}`,this.getElementsByTagName("img")[0].src=this.getAttribute("url"),this.addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("change",{detail:{lpBackgroundImage:this.getAttribute("url")},bubbles:!0}))})}}customElements.define("image-card",i)},function(t,e){const s=document.createElement("template");s.innerHTML='\n<div class="slds-form-element">\n  <label class="slds-form-element__label" for="lpHeader">\n    Landing Page Heading\n  </label>\n  <div class="slds-form-element__control">\n    <input type="text" id="lpHeader" placeholder="Heading" required="" class="slds-input" />\n  </div>\n</div>\n<div class="slds-form-element">\n  <label class="slds-form-element__label" for="lpSubheader">\n    Landing Page Subheading\n  </label>\n  <div class="slds-form-element__control">\n    <input type="text" id="lpSubheader" placeholder="Subheading" required="" class="slds-input" />\n  </div>\n</div>\n<div class="slds-form-element">\n  <label class="slds-form-element__label" for="lpForm">Form</label>\n  <div class="slds-form-element__control">\n    <textarea id="lpForm" rows="8" class="slds-textarea" placeholder="Add Form Content"></textarea>\n  </div>\n</div>\n';class i extends HTMLElement{constructor(){super(),this.inputVal=""}async connectedCallback(){this.appendChild(s.content.cloneNode(!0));[...this.querySelectorAll("input")].forEach(t=>{t.addEventListener("change",t=>{t.stopPropagation(),this.dispatchEvent(new CustomEvent("change",{detail:{[t.currentTarget.id]:t.currentTarget.value},bubbles:!0}))})}),this.querySelector("textarea").addEventListener("change",t=>{t.stopPropagation(),t.target.value=t.currentTarget.value.replace(/\/<!\[CDATA\[\//,""),t.target.value=t.currentTarget.value.replace(/\/]]>\//,""),this.dispatchEvent(new CustomEvent("change",{detail:{[t.currentTarget.id]:t.currentTarget.value},bubbles:!0}))})}}customElements.define("fields-form-block",i)},function(t,e){const s=document.createElement("template");s.innerHTML='\n<div class="focus-options">\n  <div>\n    <h3>Set Image Focus (Optional)</h3>\n  </div>\n  <small>Use <a target="_blank" href="http://jonom.github.io/jquery-focuspoint/demos/helper/index.html">Helper Tool</a> to get image focus values</small>\n</div>\n<div class="focus-fields">\n  <div class="slds-form-element">\n    <label class="slds-form-element__label" for="lpHeader">\n      Image Focus\n    </label>\n    <div class="slds-form-element__control">\n      <input type="text" id="dataFocusInput" required="" class="slds-input" />\n    </div>\n  </div>\n</div>\n';class i extends HTMLElement{constructor(){super(),this.inputVal=""}async connectedCallback(){this.appendChild(s.content.cloneNode(!0));this.querySelector("input").addEventListener("change",t=>{const e=t.currentTarget.value.split(" "),s={};e.map(t=>s[t.match(/(data-.+)=/).slice(-1)[0]]=t.match(/"(.+)"/).slice(-1)[0]),t.stopPropagation(),this.dispatchEvent(new CustomEvent("change",{detail:{focusVals:s},bubbles:!0}))})}}customElements.define("fields-focus-block",i)},function(t,e,s){"use strict";t.exports=s(5)},function(t,e,s){"use strict";function i(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return s.forEach((function(e){return Object.keys(e).forEach((function(s){return t[s]=e[s]}))})),t}Object.defineProperty(e,"__esModule",{value:!0});var n={position:"relative",overflow:"hidden"},o={position:"absolute",top:"0",right:"0",bottom:"0",left:"0"},a={display:"block",maxWidth:"100%",touchAction:"none"},r={position:"absolute",cursor:"move",transform:"translate(-50%, -50%)"},l={onChange:function(){},retina:"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20'%3e %3cg fill='none' fill-rule='evenodd'%3e %3ccircle id='a' cx='10' cy='10' r='10' fill='black' fill-opacity='.3' /%3e %3ccircle cx='10' cy='10' r='9' stroke='white' stroke-opacity='.8' stroke-width='2'/%3e %3c/g%3e%3c/svg%3e"},c=function(){function t(t,e){var s=this;void 0===e&&(e={}),this.startDragging=function(t){t.preventDefault(),s.isDragging=!0,t instanceof MouseEvent?s.updateCoordinates(t.clientX,t.clientY):s.updateCoordinates(t.touches[0].clientX,t.touches[0].clientY)},this.handleMove=function(t){if(t.preventDefault(),t instanceof MouseEvent)s.updateCoordinates(t.clientX,t.clientY);else{var e=t.touches[0],i=document.elementFromPoint(e.pageX,e.pageY);i!==s.retina&&i!==s.img?s.stopDragging():s.updateCoordinates(e.clientX,e.clientY)}},this.stopDragging=function(){s.isDragging=!1},this.updateRetinaPositionFromFocus=function(){s.updateRetinaPosition(s.calculateOffsetFromFocus())},this.updateRetinaPosition=function(t){s.retina.style.top=t.offsetY+"px",s.retina.style.left=t.offsetX+"px"},this.options=i({},l,e),this.img=t,this.container=t.parentElement,this.retina=document.createElement("img"),this.retina.src=this.options.retina,this.retina.draggable=!1,this.container.appendChild(this.retina),this.img.draggable=!1,this.startListening(),i(this.img.style,a),i(this.retina.style,r),i(this.container.style,n),this.focus=this.options.focus?this.options.focus:{x:parseFloat(this.img.getAttribute("data-focus-x"))||0,y:parseFloat(this.img.getAttribute("data-focus-y"))||0},this.setFocus(this.focus)}var e=t.prototype;return e.startListening=function(){this.container.addEventListener("mousedown",this.startDragging),this.container.addEventListener("mousemove",this.handleMove),this.container.addEventListener("mouseup",this.stopDragging),this.container.addEventListener("mouseleave",this.stopDragging),this.container.addEventListener("touchend",this.stopDragging),this.container.addEventListener("touchstart",this.startDragging,{passive:!0}),this.container.addEventListener("touchmove",this.handleMove,{passive:!0}),this.img.addEventListener("load",this.updateRetinaPositionFromFocus)},e.stopListening=function(){this.container.removeEventListener("mousedown",this.startDragging),this.container.removeEventListener("mousemove",this.handleMove),this.container.removeEventListener("mouseup",this.stopDragging),this.container.removeEventListener("mouseleave",this.stopDragging),this.container.removeEventListener("touchend",this.stopDragging),this.container.removeEventListener("touchstart",this.startDragging),this.container.removeEventListener("touchmove",this.handleMove),this.img.removeEventListener("load",this.updateRetinaPositionFromFocus)},e.setFocus=function(t){this.focus=t,this.img.setAttribute("data-focus-x",t.x.toString()),this.img.setAttribute("data-focus-y",t.y.toString()),this.updateRetinaPositionFromFocus(),this.options.onChange(t)},e.calculateOffsetFromFocus=function(){var t=this.img.getBoundingClientRect();return{offsetX:t.width*(this.focus.x/2+.5),offsetY:t.height*(this.focus.y/-2+.5)}},e.updateCoordinates=function(t,e){if(this.isDragging){var s=this.img.getBoundingClientRect();this.setFocus({x:2*((t-s.left)/s.width-.5),y:-2*((e-s.top)/s.height-.5)})}},t}(),d={minHeight:"100%",minWidth:"100%"},u={height:"100%",width:"100%",border:"none",opacity:0,zIndex:-1,pointerEvents:"none"},h={debounceTime:17,updateOnWindowResize:!0,updateOnContainerResize:!1,containerPosition:"relative"},p=function(){function t(t,e){var s,a,r,l=this;void 0===e&&(e={}),this.imageNode=t,this.listening=!1,this.setFocus=function(t){l.focus=t,l.img.setAttribute("data-focus-x",t.x.toString()),l.img.setAttribute("data-focus-y",t.y.toString()),l.applyShift()},this.applyShift=function(){var t=l.img,e=t.naturalWidth,s=t.naturalHeight,i=l.container.getBoundingClientRect(),n=i.width,o=i.height,a="0",r="0";if(!(n>0&&o>0&&e>0&&s>0))return!1;var c=e/n,d=s/o;l.img.style.maxHeight=null,l.img.style.maxWidth=null,e>n&&s>o&&(l.img.style[c>d?"maxHeight":"maxWidth"]="100%"),c>d?a=l.calcShift(d,n,e,l.focus.x)+"%":c<d&&(r=l.calcShift(c,o,s,l.focus.y,!0)+"%"),l.img.style.top=r,l.img.style.left=a},this.options=i(h,e),this.img=t,this.container=t.parentElement,this.img.__focused_image_instance__&&(this.img.__focused_image_instance__.stopListening(),this.img.removeEventListener("load",this.applyShift)),this.img.__focused_image_instance__=this,this.img.addEventListener("load",this.applyShift),i(this.container.style,n),this.container.style.position=this.options.containerPosition,i(this.img.style,d,o),this.debounceApplyShift=(s=this.applyShift,a=this.options.debounceTime,function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];clearTimeout(r),r=setTimeout((function(){return s.apply(void 0,e)}),a)}),this.focus=this.options.focus?this.options.focus:{x:parseFloat(this.img.getAttribute("data-focus-x"))||0,y:parseFloat(this.img.getAttribute("data-focus-y"))||0},this.startListening(),this.setFocus(this.focus)}var e=t.prototype;return e.startListening=function(){var t=this;if(!this.listening&&(this.listening=!0,this.options.updateOnWindowResize&&window.addEventListener("resize",this.debounceApplyShift),this.options.updateOnContainerResize)){var e=document.createElement("object");i(e.style,u,o),e.addEventListener("load",(function(s){return e.contentDocument.defaultView.addEventListener("resize",(function(){return t.debounceApplyShift()}))})),e.type="text/html",e.setAttribute("aria-hidden","true"),e.tabIndex=-1,this.container.appendChild(e),e.data="about:blank",this.resizeListenerObject=e}},e.stopListening=function(){this.listening&&(this.listening=!1,window.removeEventListener("resize",this.debounceApplyShift),this.resizeListenerObject&&(this.resizeListenerObject.contentDocument.defaultView.removeEventListener("resize",this.debounceApplyShift),this.container.removeChild(this.resizeListenerObject),this.resizeListenerObject=null))},e.calcShift=function(t,e,s,i,n){var o=Math.floor(e/2),a=(i+1)/2,r=Math.floor(s/t),l=Math.floor(a*r);n&&(l=r-l);var c=l-o,d=r-l,u=e-o;return d<u&&(c-=u-d),c<0&&(c=0),-100*c/e},t}();e.FocusPicker=c,e.FocusedImage=p},function(t,e,s){"use strict";async function i(t,e){const s=await fetch("/proxy/"+t,{method:"POST",body:JSON.stringify(e)});return await s.json()}s.r(e);const n=function(){let t;return async()=>(t||(t=await i("asset/v1/content/assets/query",{query:{property:"fileProperties.extension",simpleOperator:"in",value:["tif","tiff","bmp","jpg","jpeg","gif","png"]},page:{page:1,pageSize:2e3}})),t)}();s(1);const o=document.createElement("template");o.innerHTML='\n<div class="slds-m-top_small slds-m-bottom_small">\n<button class="slds-button slds-button_neutral slds-align_absolute-center">Select Image</button>\n</div>\n<div class="slds-grid slds-gutters slds-wrap slds-grid_vertical-stretch" style="display: none;"></div>\n';class a extends HTMLElement{constructor(){super(),this._toggleSelector=this._toggleSelector.bind(this)}async connectedCallback(){this.appendChild(o.content.cloneNode(!0)),this.grid=this.getElementsByClassName("slds-grid")[0],this.getElementsByTagName("button")[0].addEventListener("click",this._toggleSelector),this.addEventListener("change",t=>{this.value=t.detail.lpBackgroundImage,this._toggleSelector()});const t=await n();this.grid.innerHTML=t.items.map(this._getImageHTML).join("")}_getImageHTML(t){return`\n\t\t\t<div class="slds-col slds-size_1-of-2 slds-p-top_x-small">\n\t\t\t\t<image-card \n\t\t\t\t\tid="${t.id}" \n\t\t\t\t\tname="${t.name}" \n\t\t\t\t\turl="${t.fileProperties.publishedURL}" \n\t\t\t\t\timgHeight="${t.fileProperties.height}" \n\t\t\t\t\timgWidth="${t.fileProperties.width}"></image-card>\n\t\t\t</div>\n\t\t`}_toggleSelector(){this.grid.style.display="none"===this.grid.style.display?"flex":"none"}}customElements.define("image-selector-block",a);const r=document.createElement("template");r.innerHTML='\n<div class="slds-box">\n</div>\n';class l extends HTMLElement{set fields(t){t&&(this.firstElementChild.innerHTML=t.map(this.getFieldHtml).join(""),this._fields=t)}async connectedCallback(){this.appendChild(r.content.cloneNode(!0)),this.firstElementChild.addEventListener("change",t=>{t.stopPropagation(),this.dispatchEvent(new CustomEvent("change",{detail:{fields:this._fields.map((t,e)=>({...t,value:this.querySelector("#template-field-"+e).value}))},bubbles:!1}))})}getFieldHtml(t,e){return`\n<div class="slds-form-element">\n\t<label class="slds-form-element__label" for="template-field-${e}">${t.title}</label>\n\t<div class="slds-form-element__control">\n\t\t${"image"===t.type?"<image-selector ":'<input type="text" class="slds-input" '} id="template-field-${e}" value="${t.value||""}" />\n\t</div>\n</div>\n`}}customElements.define("templating-block-fieldset",l);s(2),s(3);class c extends HTMLElement{set fields(t){this.fieldSet.fields=t}connectedCallback(){const t=document.createElement("image-selector-block");this.appendChild(t);const e=document.createElement("fields-focus-block");this.appendChild(e);const s=document.createElement("fields-form-block");this.appendChild(s)}}customElements.define("templating-block-app",c);var d=s(0),u=s.n(d);function h({lpHeader:t="",lpSubheader:e="",lpBackgroundImage:s="",lpForm:i="",...n}){return console.log(n),`\n\t<div \n\t\talign="center" \n\t\tclass="smc-lp__data-container focuspoint"\n\t\tdata-focus-x=${n.focusVals?n.focusVals["data-focus-x"]:""}\n\t\tdata-focus-y=${n.focusVals?n.focusVals["data-focus-y"]:""}\n\t\tdata-image-w=${n.focusVals?n.focusVals["data-image-w"]:""}\n\t\tdata-image-h=${n.focusVals?n.focusVals["data-image-h"]:""}\n\t>\n\t\t<div class="smc-lp__text-conatiner">\n\t\t\t<h1 class="smc-lp__title">\n\t\t\t\t${t}\n\t\t\t</h1>\n\t\t\t<p class="smc-lp__description">\n\t\t\t\t${e}\n\t\t\t</p>\n\t\t</div>\n\t\t<div class="smc-lp__form-container">\n\t\t\t${i}\n\t\t</div>\n\t\t<img class="focused-image" src="${s}" style="width: auto !important;"/>\n\t</div>\n`}s(4);const p=new u.a(null,null,!0);function g(t){const e=document.createElement("templating-block-app");e.locked=t.locked,t.template&&(e.assetId=t.template.id),e.addEventListener("change",t=>{p.getData(e=>{!function(t){p.setData(t),p.setContent(h(t)),p.setSuperContent(h(t))}({...e,...t.detail})})}),document.getElementById("workspace").appendChild(e)}p.getData(async t=>{g(t)})}]);
//# sourceMappingURL=main.js.map